

# ìŠ¤í”„ë§ ì‹œíë¦¬í‹° ê°•ì˜ ë¦¬ë·°ğŸ“½
> LoadMap Part : í¼ ì¸ì¦   
> Section :  01  
> CreateDate : 2022.09.12    
> UpdateDate :  

### ëª©ì°¨
- í¼ì¸ì¦ êµ¬ì„±
- ë§Œë“¤ê¸°
- ì‹œíë¦¬í‹° ì—°ë™
- ì‹œíë¦¬í‹° ì„¤ì •
- ì»¤ìŠ¤í„°ë§ˆì´ì§•
  - ì¸ë©”ëª¨ë¦¬ ìœ ì € ì¶”ê°€
  - JPA ì—°ë™
  - PasswordEncoder
- í…ŒìŠ¤íŠ¸

<br></br>
<br></br>

# í¼ì¸ì¦ êµ¬ì„±
## ë§Œë“¤ í¼ ì¸ì¦ ì˜ˆì œ êµ¬ì¡°
> í˜ì´ì§€ ê¸°ì¤€ìœ¼ë¡œ êµ¬ì¡°ë¥¼ ë‚˜ëˆ´ìŠµë‹ˆë‹¤. (ë·°ëŠ” thymeleaf ì‚¬ìš©)
 1. í™ˆ í˜ì´ì§€(/)
    - ì¸ì¦ëœ ì‚¬ìš©ìë„ ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë©° ì¸ì¦í•˜ì§€ ì•Šì€ ì‚¬ìš©ìë„ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
      - ì¦‰, ì¸ì¦ì´ í•„ìš”ì—†ë‹¤
    - ì¸ì¦ëœ ì‚¬ìš©ìê°€ ë¡œê·¸ì¸ í•œ ê²½ìš°ì—ëŠ” ì´ë¦„ì„ ì¶œë ¥
      - ì¸ì¦í™•ì¸ í•„ìš”!
 2. ì •ë³´(/info)
    - ì´ í˜ì´ì§€ëŠ” ì¸ì¦ì„ í•˜ì§€ ì•Šê³ ë„ ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë©°, ì¸ì¦ì„ í•œ ì‚¬ìš©ìë„ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
 3. ëŒ€ì‹œë³´ë“œ(/dashboard)
    - ì´ í˜ì´ì§€ëŠ” ë°˜ë“œì‹œ ë¡œê·¸ì¸ í•œ ì‚¬ìš©ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
    - ì¸ì¦í•˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ ì ‘ê·¼í•  ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•œë‹¤.
 4. ì–´ë“œë¯¼(/admin)
    - ì´ í˜ì´ì§€ëŠ” ë°˜ë“œì‹œ ADMIN ê¶Œí•œì„ ê°€ì§„ ì‚¬ìš©ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
        - ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìê°€ ì ‘ê·¼í•  ì‹œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™
        - ì¸ì¦ì„ ê±°ì³¤ìœ¼ë‚˜, ê¶Œí•œì´ ì¶©ë¶„í•˜ì§€ ì•Šìœ¼ë©´ ì—ëŸ¬í˜ì´ì§€ ì¶œë ¥

<br></br>
<br></br>


# í”„ë¡œì íŠ¸ ë§Œë“¤ê¸° 
 > ìŠ¤í”„ë§ë¶€íŠ¸ì™€ íƒ€ì„ë¦¬í”„ë¥¼ ì‚¬ìš©   
 > web-start, thymeleaf ì˜ì¡´ì„± ì¶”ê°€   
 - ìœ„ì— êµ¬ì„±í•œ í˜ì´ì§€ì™€ í•¸ë“¤ëŸ¬ ë§Œë“¤ê¸°
 - thymeleafë¡œ ë§Œë“  htmlì€ ìƒëµí•œë‹¤.
```java
@Controller
public class DemoController {

    @GetMapping("/")
    public String homePage(Model model, Principal principal){
        if(principal == null){
            model.addAttribute("message", "Hello spring Security");
        }else {
            model.addAttribute("message", "Hello"+ principal.getName());
        }

        return "index";
    }

    @GetMapping("/info")
    public String info(Model model){
        model.addAttribute("message", "Info");
        return "info";
    }
    @GetMapping("/dashboard")
    public String dashboard(Model model, Principal principal){
        model.addAttribute("message", "Hello" + principal.getName());
        return "dashboard";
    }
    @GetMapping("/admin")
    public String admin(Model model, Principal principal){
        model.addAttribute("message","Hello Admin" + principal.getName() );
        return "admin";
    }
}
```
 - `principal`ì€ ìœ ì €ì˜ ì£¼ìš”í•œ ì •ë³´ë¥¼ ë‹´ê³  ìˆë‹¤. 

### principal
- ê¸°ë³¸ì ìœ¼ë¡œ ì¸í„°í˜ì´ìŠ¤ì´ë©°, `UsernamePasswordAuthenticationToken`ì™€ ì—°ê´€ì´ ìˆë‹¤.
- ì•„ë˜ì™€ ê°™ì´, `principal`ì€ ì¸ì¦í† í°ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆëŠ” êµ¬í˜„ì²´ì˜ ìµœìƒìœ„ ì¸í„°í˜ì´ìŠ¤ ì´ë‹¤.
<p align="center"><img src="https://user-images.githubusercontent.com/104331549/189642149-f1aba0ba-e5ab-4906-88fc-4ff2f93311ba.png" width="70%"></p> 

```java
import javax.security.auth.Subject;

public interface Principal {

    public boolean equals(Object another);

    public String toString();

    public int hashCode();

    public String getName();


    public default boolean implies(Subject subject) {
        if (subject == null)
            return false;
        return subject.getPrincipals().contains(this);
    }
}
```

<br></br>
<br></br>

# Spring Security ì—°ë™
 - build.gradleì— securityë¥¼ ì¶”ê°€í•œë‹¤.
```groovy
implementation 'org.springframework.boot:spring-boot-starter-security'
```
 - ì¶”ê°€ë¥¼ í•´ì£¼ëŠ” ìˆœê°„, Spring security ê´€ë ¨ ê¸°ë³¸ì ì¸ Login í™”ë©´ì´ ë‚˜íƒ€ë‚œë‹¤. 
<p align="center"><img src="https://user-images.githubusercontent.com/104331549/189649273-61385c2e-4287-4180-98a0-eb190d7b2526.png" width="60%"></p> 

 - ë¬¼ë¡ , í™ˆí˜ì´ì§€, ì •ë³´, ëŒ€ì‰¬ë³´ë“œ, ì–´ë“œë¯¼ ì–´ë””ë“  ì ‘ê·¼í•˜ë ¤ë©´ ë¡œê·¸ì¸ì„ í•´ì•¼ëœë‹¤. 

### ë¡œê·¸ì¸ í•˜ëŠ”ë²•
 - ê¸°ë³¸ì ìœ¼ë¡œ Spring securityì—ì„œ ì œê³µí•´ì£¼ëŠ” ê¸°ë³¸ ì•„ì´ë””ì™€ Passwordê°€ ìˆë‹¤. 
   - ê¸°ë³¸ ì•„ì´ë”” `user`
   - ì œê³µí•˜ëŠ” `Password` ëŠ” ì‹¤í–‰í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ì œê³µì„ í•´ì¤€ë‹¤.
   - <img src="https://user-images.githubusercontent.com/104331549/189650526-0321d1fe-6321-4dba-a10f-df8659a75d40.png">
 - ë¬¼ë¡  ì‹¤ì œ ì„œë¹„ìŠ¤ì— ì‚¬ìš©í•˜ë©´ ì•ˆë˜ëŠ” ë°©ë²•ì´ê¸´í•˜ì§€ë§Œ, ê°€ì¥ ê¸°ì´ˆì ì¸ ë°©ë²•ì´ë‹¤.

### securityë¥¼ ì¶”ê°€í•¨ìœ¼ë¡œì¨ í•´ê²°ëœ ì 
 - ì¸ì¦(ë¡œê·¸ì¸)ì„ í•  ìˆ˜ ìˆë‹¤.
 - í˜„ì¬ ì‚¬ìš©ì ì •ë³´(principal)ë¥¼ ì•Œ ìˆ˜ ìˆë‹¤.


<br></br>
<br></br>

# Spring security ì„¤ì •í•˜ê¸°
 - ê°€ì¥ ë¨¼ì € ì„¤ì •ì„ í•  ìˆ˜ ìˆëŠ” `SecurityConfig`ë¥¼ ë§Œë“ ë‹¤.
 - ê·¸ë¦¬ê³  `WebSecurityConfigurerAdapter`ë¥¼ ìƒì†ë°›ì•„ ì„¤ì •ì„ ì˜¤ë²„ë¼ì´ë”©í•˜ì—¬, ì„¤ì •í•´ì•¼í•˜ì§€ë§Œ
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig extends WebSecurityConfigurerAdapter {
    @Override
    protected void configure(HttpSecurity http) throws Exception{
        http.authorizeRequests()
                .mvcMatchers("/", "/info").permitAll()
                .mvcMatchers("/admin").hasRole("ADMIN")
                .anyRequest().authenticated();

        http.formLogin(); // í¼ë¡œê·¸ì¸ ê¸°ë³¸
        http.httpBasic(); // 

    }
}
```
 - ê°•ì˜ì—ì„œëŠ” `WebSecurityConfigurerAdapter`ë¥¼ ìƒì†ë°›ì•„ ì§„í–‰ì„ í•˜ì§€ë§Œ, í˜„ì¬ì¼ìë¡œëŠ” `@Deprecated` ë˜ì–´ ìˆì–´ ê¶Œì¥í•˜ê³  ìˆì§€ ì•Šê³  ìˆë‹¤. 

## Deprecated WebSecurityConfigurerAdapter ì–´ë–»í•˜ì§€? 
 - ìŠ¤í”„ë§ ë²„ì „ì´ ì—…ë°ì´íŠ¸ ë¨ì— ë”°ë¼  `WebSecurityConfigurerAdapter`ì™€ ê·¸ ì™¸ ëª‡ ê°€ì§€ë“¤ì´ Deprecated ëë‹¤.
 - ê¸°ì¡´ ì˜¤ë²„ë¼ì´ë”© ë°©ì‹ìœ¼ë¡œëŠ” ëª»í•˜ê³  ëª¨ë‘ `Bean`ìœ¼ë¡œ ë“±ë¡í•˜ì—¬ ì ìš©í•´ì•¼í•œë‹¤.
   - ê²Œë‹¤ê°€, SecurityFilterChainë¥¼ Beanìœ¼ë¡œ ë“±ë¡í•˜ì—¬ ê¸°ì¡´ Configì„¤ì • ë°©ì‹ì„ ì ìš©í•´ì•¼í•œë‹¤.
```java
@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception{
        http.authorizeRequests()
                .mvcMatchers("/", "/info").permitAll()
                .mvcMatchers("/admin").hasRole("ADMIN")
                .anyRequest().authenticated();

        http.formLogin();
        http.httpBasic();

        return http.build();
    }
}
```
- ë‹¤ì‹œí•œë²ˆ ì–¸ê¸‰í•˜ì§€ë§Œ ì „ì²´ì ì¸ ë¡œì§ìì²´ëŠ” ë™ì¼í•˜ë‹¤, ì°¨ì´ê°€ ìˆë‹¤ë©´, `SecurityFilterChain`ìœ¼ë¡œ ë°˜í™˜í•˜ê³  ì˜¤ë²„ë¼ì´ë”©ì´ì•„ë‹Œ `@Bean`ë“±ë¡í•˜ëŠ” ê²ƒ ë¿ì´ë‹¤.
- `.authorizeRequests()` : ìš”ì²­ì— ëŒ€í•œ ê¶Œí•œì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.
- `.anyRequest().authenticated()` : ì¸ì¦ì´ ë˜ì–´ì•¼ í•œë‹¤ëŠ” ì´ì•¼ê¸°ì´ë‹¤.
- 
### antMatchers ì™€ mvcMatchers 
 - antMatcher(String antPattern) : HttpSecurityì œê³µëœ ant íŒ¨í„´ê³¼ ì¼ì¹˜í•  ë•Œë§Œ í˜¸ì¶œë˜ë„ë¡ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.
   - ì¦‰, antMatchersì˜ ê²½ìš°ëŠ” ë’¤ì— ë‚˜ì˜¤ëŠ” url pattern ê°’ì´ ì •í™•íˆ ì¼ì¹˜í•  ë•Œë§Œ í˜¸ì¶œ ë˜ëŠ” í•¨ìˆ˜ì´ë‹¤.
 - mvcMatcher(String mvcPattern) : HttpSecurityì œê³µëœ Spring MVC íŒ¨í„´ê³¼ ì¼ì¹˜í•  ë•Œë§Œ í˜¸ì¶œë˜ë„ë¡ êµ¬ì„±í•  ìˆ˜ ìˆë‹¤.
   - ì¦‰, mvcMatcherì˜ ê²½ìš° ë’¤ì— ë‚˜ì˜¤ëŠ” url patternì´ ë‹¨ì–´ë§Œ ì¼ì¹˜í•˜ë©´ ëœë‹¤. 
   - ì˜ˆë¥¼ ë“¤ì–´, `/users`ë¼ê³  í•˜ë©´, `/users`, `/users/`, `/users.html` ë‹¤ ê°€ëŠ¥í•˜ë‹¤.

### ê·¸ë°–ì˜ ì¸ê°€ê´€ë ¨ ë©”ì†Œë“œ
 - `.permitAll()`:  ì ‘ê·¼ì„ ì „ë¶€ í—ˆìš©í•œë‹¤.
 - `denyAll()` : ì ‘ê·¼ì„ ì „ë¶€ ì œí•œí•œë‹¤.  
 - `.anonymous()` : ì¸ì¦ë˜ì§€ ì•Šì€ ì‚¬ìš©ìë„ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
 - `.fullyAuthenticated()` : ì™„ì „íˆ ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
 - `.hasRole()` or `hasAnyRole()`: **íŠ¹ì • ì—­í• **ì„ ê°€ì§€ëŠ” ì‚¬ìš©ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
 - `.hasAuthority()` or `hasAnyAuthority()` : **íŠ¹ì • ê¶Œí•œ**ì„ ê°€ì§€ëŠ” ì‚¬ìš©ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
    - ì—­ê¸°ì„œ `any`ëŠ” ì£¼ì–´ì§„ ì¡°ê±´ì¤‘ í•˜ë‚˜ë¼ë„ ìˆìœ¼ë©´, í—ˆìš©í•œë‹¤.
 - `.hasIpAddress()` : íŠ¹ì • ì•„ì´í”¼ ì£¼ì†Œë¥¼ ê°€ì§€ëŠ” ì‚¬ìš©ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
 - `.access()` : `SpEL í‘œí˜„ì‹`ì— ì˜í•œ ê²°ê³¼ì— ë”°ë¼ ture ì´ë©´ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.
 - `.not()` : ì ‘ê·¼ ì œí•œ ê¸°ëŠ¥ì„ í•´ì œ
 - `.rememberMe()` : ë¡œê·¸ì¸í•œ ì‚¬ìš©ìë§Œ ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤. ë¦¬ë©¤ë²„ê¸°ëŠ¥ 


# ì»¤ìŠ¤í„°ë§ˆì´ì§•
## ì¸ë©”ëª¨ë¦¬ ìœ ì € ì¶”ê°€
> ì—¬íƒœê¹Œì§€ í•œ ë°©ë²•ìœ¼ë¡œëŠ” securityì—ì„œ ì œê³µí•˜ëŠ” Login, Logout, ê¸°ë³¸ user/PW ì •ë„ì´ë‹¤. 
> ì¦‰, ê´€ë¦¬ì ê³„ì •ì€ ì»¤ìŠ¤í…€ìœ¼ë¡œ ë§Œë“¤ì–´ì¤˜ì•¼í•œë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.
 - í•˜ì§€ë§Œ, ì´ê²ƒ ì—­ì‹œ, í˜„ì¬ëŠ” `WebSecurityConfigurerAdapter`ë¥¼ ìƒì†ë°›ì•„ ì§„í–‰í•´ì•¼í•˜ëŠ” ë°©ë²•ë¿ì´ë‹¤.í•˜ì§€ë§Œ, `@Deprecated` ë˜ì—ˆê¸° ë•Œë¬¸ì— ë‹¤ë¥¸ ë°©ë²•ì„ ì•Œì•„ ë´¤ë‹¤.
 - [ìŠ¤í”„ë§ ê³µì‹ í™ˆí˜ì´ì§€ In-Memory Authentication](https://docs.spring.io/spring-security/reference/servlet/authentication/passwords/in-memory.html)